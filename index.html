<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MOVES</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23e94560'/%3E%3Cpath d='M30 55 L45 70 L70 35' stroke='white' stroke-width='8' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        :root {
            --bg: #1a1a2e;
            --card: #16213e;
            --accent: #e94560;
            --accent2: #0f3460;
            --text: #eaeaea;
            --text-dim: #8892b0;
            --success: #4ecca3;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding-bottom: 100px;
        }
        
        header {
            background: #0a0a0a;
            padding: 12px 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(201, 162, 39, 0.3);
        }

        /* Daily Affirmation Banner Styles */
        .affirmation-banner {
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.15) 0%, rgba(184, 148, 43, 0.08) 50%, rgba(201, 162, 39, 0.15) 100%);
            border-top: 1px solid rgba(201, 162, 39, 0.4);
            border-bottom: 1px solid rgba(201, 162, 39, 0.4);
            padding: 16px 20px;
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .affirmation-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(232, 212, 138, 0.2), transparent);
            animation: shimmer 4s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }

        .affirmation-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 120%;
            background: radial-gradient(ellipse, rgba(201, 162, 39, 0.3) 0%, transparent 70%);
            filter: blur(20px);
            animation: pulse 3s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.05); }
        }

        .affirmation-content {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .affirmation-icon {
            font-size: 1.4rem;
            animation: float 2s ease-in-out infinite;
            filter: drop-shadow(0 0 8px rgba(201, 162, 39, 0.6));
        }

        .affirmation-icon:last-child {
            animation-delay: 1s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .affirmation-text {
            font-family: 'Georgia', 'Didot', serif;
            font-size: 1.05rem;
            font-weight: 500;
            font-style: italic;
            color: #E8D48A;
            text-shadow: 0 0 20px rgba(232, 212, 138, 0.5), 0 0 40px rgba(201, 162, 39, 0.3);
            letter-spacing: 0.5px;
            line-height: 1.4;
            max-width: 600px;
        }

        .affirmation-sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #E8D48A;
            border-radius: 50%;
            top: 20%;
            left: 10%;
            animation: sparkle 2s ease-in-out infinite;
            box-shadow: 0 0 10px #E8D48A, 0 0 20px #C9A227;
        }

        .affirmation-sparkle::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 4px;
            background: #E8D48A;
            border-radius: 50%;
            top: 300%;
            left: 800%;
            animation: sparkle 2.5s ease-in-out infinite 0.5s;
            box-shadow: 0 0 10px #E8D48A, 0 0 20px #C9A227;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tabs {
            display: flex;
            background: var(--card);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 14px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-dim);
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }
        
        .view { display: none; }
        .view.active { display: block; }
        
        .container { padding: 16px; max-width: 600px; margin: 0 auto; }
        
        /* Calendar Styles */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .calendar-nav button {
            background: var(--accent2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .calendar-title {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .view-toggle {
            display: flex;
            gap: 4px;
        }
        
        .view-toggle button {
            background: var(--card);
            border: 1px solid var(--accent2);
            color: var(--text-dim);
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.7rem;
        }
        
        .view-toggle button.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }
        
        .calendar-grid {
            background: var(--card);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: var(--accent2);
        }
        
        .weekday {
            padding: 10px;
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-dim);
        }
        
        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }
        
        .day {
            aspect-ratio: 1;
            padding: 4px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
            cursor: pointer;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .day:hover { background: rgba(255,255,255,0.05); }
        .day.other-month { color: var(--text-dim); opacity: 0.4; }
        .day.today { background: var(--accent2); }
        .day.today .day-num { color: var(--accent); font-weight: bold; }
        .day.selected { background: var(--accent); }
        
        .day-num { font-size: 0.85rem; margin-bottom: 2px; }
        
        .day-events {
            display: flex;
            gap: 2px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .event-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success);
        }
        
        /* Daily/Weekly View */
        .schedule {
            background: var(--card);
            border-radius: 12px;
            padding: 16px;
        }
        
        .schedule-day {
            margin-bottom: 16px;
        }
        
        .schedule-day-header {
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .schedule-day-header.today { color: var(--success); }
        
        .event {
            background: rgba(255,255,255,0.05);
            border-left: 3px solid var(--accent);
            padding: 10px 12px;
            margin-bottom: 8px;
            border-radius: 0 6px 6px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .event-title { font-size: 0.9rem; }
        .event-time { font-size: 0.75rem; color: var(--text-dim); }
        
        .no-events {
            color: var(--text-dim);
            font-style: italic;
            font-size: 0.85rem;
        }
        
        /* Annual View */
        .annual-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .mini-month {
            background: var(--card);
            border-radius: 8px;
            padding: 10px;
        }
        
        .mini-month-title {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--accent);
        }
        
        .mini-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            font-size: 0.6rem;
        }
        
        .mini-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 2px;
        }
        
        .mini-day.has-event { background: var(--success); color: var(--bg); }
        .mini-day.today { background: var(--accent); color: white; }
        
        /* Business/Task Styles */
        .business {
            background: var(--card);
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
        }
        
        .business-header {
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-left: 4px solid var(--accent);
        }
        
        .business-header h2 { font-size: 1.1rem; font-weight: 600; }
        .business-header .progress { font-size: 0.8rem; color: var(--success); }
        
        .business-content { padding: 0 16px 16px; display: none; }
        .business.open .business-content { display: block; }
        
        .goal {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
        }
        
        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .goal-header h3 { font-size: 0.95rem; color: var(--accent); }
        
        .step {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .step:last-child { border-bottom: none; }
        
        .step input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            accent-color: var(--success);
        }
        
        .step.done span { text-decoration: line-through; color: var(--text-dim); }
        
        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            margin-right: 8px;
            margin-top: 8px;
        }
        
        .btn:hover { opacity: 0.9; }
        .btn.small { padding: 4px 10px; font-size: 0.75rem; }
        .btn.ghost { background: transparent; border: 1px solid var(--accent); }
        .btn.danger { background: #c0392b; }
        
        .add-form { display: flex; gap: 8px; margin-top: 12px; }
        
        .add-form input, .event-form input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            color: var(--text);
            font-size: 0.9rem;
        }
        
        .add-form input::placeholder, .event-form input::placeholder { color: var(--text-dim); }
        
        .fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--accent);
            color: white;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(233,69,96,0.4);
            z-index: 50;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.open { display: flex; }
        
        .modal-content {
            background: var(--card);
            padding: 24px;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
        }
        
        .modal-content h2 { margin-bottom: 16px; }
        
        .modal-content input, .modal-content select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            color: var(--text);
            font-size: 1rem;
            margin-bottom: 12px;
        }
        
        .modal-content label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-dim);
            margin-bottom: 4px;
        }
        
        .actions { display: flex; gap: 8px; }
        .actions .btn { flex: 1; text-align: center; }
        
        .edit-delete { display: flex; gap: 4px; }

        /* Summary Section */
        .summary-section {
            margin-top: 24px;
            padding: 16px 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .summary-content {
            font-size: 0.85rem;
            color: var(--text-dim);
            line-height: 1.5;
            text-align: center;
        }

        .summary-content .highlight {
            color: var(--success);
            font-weight: 500;
        }

        .summary-content .deadline {
            color: var(--accent);
            font-weight: 500;
        }

        .summary-content .streak {
            color: #E8D48A;
            font-weight: 500;
        }

        .summary-content .milestone {
            color: var(--success);
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-container">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 200" style="width: 220px; height: auto;">
                <defs>
                    <linearGradient id="textGoldH" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#B8942B"/><stop offset="25%" style="stop-color:#E8D48A"/><stop offset="50%" style="stop-color:#C9A227"/><stop offset="75%" style="stop-color:#E8D48A"/><stop offset="100%" style="stop-color:#B8942B"/></linearGradient>
                    <linearGradient id="streakGoldH" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#C9A227" stop-opacity="0"/><stop offset="50%" style="stop-color:#E8D48A"/><stop offset="100%" style="stop-color:#C9A227"/></linearGradient>
                    <filter id="glowH"><feGaussianBlur stdDeviation="2" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                </defs>
                <rect width="400" height="200" fill="#0a0a0a"/>
                <g filter="url(#glowH)">
                    <rect x="30" y="68" width="50" height="5" rx="2" fill="url(#streakGoldH)" opacity="0.5"/>
                    <rect x="20" y="82" width="70" height="6" rx="3" fill="url(#streakGoldH)" opacity="0.8"/>
                    <rect x="30" y="97" width="50" height="5" rx="2" fill="url(#streakGoldH)" opacity="0.5"/>
                </g>
                <text x="230" y="105" font-family="Didot, Bodoni MT, Georgia, serif" font-size="72" font-weight="700" letter-spacing="6" text-anchor="middle" fill="url(#textGoldH)" filter="url(#glowH)">MOVES</text>
                <text x="200" y="152" font-family="Didot, Bodoni MT, Georgia, serif" font-size="19" font-weight="300" font-style="italic" letter-spacing="3" text-anchor="middle" fill="#E8E8E8">Run Your Life Like a Boss</text>
            </svg>
        </div>
    </header>
    
    <!-- Daily Affirmation Banner -->
    <div class="affirmation-banner">
        <div class="affirmation-glow"></div>
        <div class="affirmation-content">
            <span class="affirmation-icon">ðŸ‘‘</span>
            <span class="affirmation-text" id="daily-affirmation">Loading your million dollar mindset...</span>
            <span class="affirmation-icon">ðŸ’Ž</span>
        </div>
        <div class="affirmation-sparkle"></div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('tasks')">Tasks</div>
        <div class="tab" onclick="switchTab('calendar')">Calendar</div>
    </div>
    
    <div id="tasks-view" class="view active">
        <div class="container" id="app"></div>
        <div class="container">
            <div class="summary-section" id="summary-section">
                <div class="summary-content" id="summary-content">Loading your progress...</div>
            </div>
        </div>
    </div>
    
    <div id="calendar-view" class="view">
        <div class="container">
            <div class="calendar-header">
                <div class="calendar-nav">
                    <button onclick="navCalendar(-1)">â€¹</button>
                    <span class="calendar-title" id="calendar-title">February 2026</span>
                    <button onclick="navCalendar(1)">â€º</button>
                </div>
                <div class="view-toggle">
                    <button class="active" onclick="setCalView('daily')">Day</button>
                    <button onclick="setCalView('weekly')">Week</button>
                    <button onclick="setCalView('monthly')">Month</button>
                    <button onclick="setCalView('annual')">Year</button>
                </div>
            </div>
            <div id="calendar-content"></div>
        </div>
    </div>
    
    <button class="fab" onclick="openAdd()">+</button>
    
    <div class="modal" id="modal">
        <div class="modal-content" id="modal-inner"></div>
    </div>

    <script>
        let data = JSON.parse(localStorage.getItem('moves-data')) || getDefaultData();
        let currentTab = 'tasks';
        let calView = 'monthly';
        let calDate = new Date();
        let selectedDate = new Date();
        
        function getDefaultData() {
            return {
                businesses: [
                    { id: 1, name: "Laugh Therapy", goals: [
                        { id: 1, name: "Murder Mystery Events", steps: [
                            { id: 1, text: "Book venue for March event", done: false },
                            { id: 2, text: "Write script", done: false },
                            { id: 3, text: "Cast actors", done: false }
                        ]},
                        { id: 2, name: "Haha Tuesday", steps: [
                            { id: 1, text: "Book comedians for Feb", done: false },
                            { id: 2, text: "Promote on social media", done: false }
                        ]},
                        { id: 3, name: "Grant Applications", steps: [] }
                    ]},
                    { id: 2, name: "Plot House Productions", goals: [
                        { id: 1, name: "Black Dads Film", steps: [
                            { id: 1, text: "Complete first draft", done: true },
                            { id: 2, text: "Revision pass", done: false },
                            { id: 3, text: "Send to readers", done: false }
                        ]}
                    ]},
                    { id: 3, name: "Community Passageways", goals: [
                        { id: 1, name: "Case Management", steps: [
                            { id: 1, text: "Weekly client check-ins", done: false },
                            { id: 2, text: "Update Apricot notes", done: false }
                        ]}
                    ]},
                    { id: 4, name: "Personal Projects", goals: [
                        { id: 1, name: "JOJO's Adventure Book", steps: [] },
                        { id: 2, name: "YouTube Animated Series", steps: [] }
                    ]},
                    { id: 5, name: "Book Publishing", goals: [
                        { id: 1, name: "The Cookout Trivia", steps: [] },
                        { id: 2, name: "Act Out Games", steps: [] }
                    ]}
                ],
                events: []
            };
        }
        
        if (!data.events) data.events = [];
        
        function save() {
            localStorage.setItem('moves-data', JSON.stringify(data));
            renderSummary();
        }

        // Summary Section Logic
        function getUpcomingDeadline() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const upcomingEvents = data.events
                .filter(e => {
                    const eventDate = new Date(e.date + 'T12:00:00');
                    return eventDate >= today;
                })
                .sort((a, b) => new Date(a.date) - new Date(b.date));

            if (upcomingEvents.length === 0) return null;

            const nextEvent = upcomingEvents[0];
            const eventDate = new Date(nextEvent.date + 'T12:00:00');
            const daysDiff = Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24));

            return {
                title: nextEvent.title,
                days: daysDiff,
                date: nextEvent.date
            };
        }

        function getRecentWins() {
            // Get completion history from localStorage or initialize
            let history = JSON.parse(localStorage.getItem('moves-completion-history')) || {};
            const today = new Date().toISOString().split('T')[0];

            // Count completed steps today
            let completedToday = 0;
            data.businesses.forEach(b => {
                b.goals.forEach(g => {
                    g.steps.forEach(s => {
                        if (s.done) {
                            // Track when step was completed (approximate based on history)
                            const stepKey = `${b.id}-${g.id}-${s.id}`;
                            if (!history[stepKey]) {
                                history[stepKey] = today;
                                completedToday++;
                            }
                        }
                    });
                });
            });

            // Clean up history for deleted steps
            const validKeys = new Set();
            data.businesses.forEach(b => {
                b.goals.forEach(g => {
                    g.steps.forEach(s => {
                        validKeys.add(`${b.id}-${g.id}-${s.id}`);
                    });
                });
            });

            Object.keys(history).forEach(key => {
                if (!validKeys.has(key)) delete history[key];
            });

            localStorage.setItem('moves-completion-history', JSON.stringify(history));

            // Count completions in the last 7 days
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

            let weeklyCompletions = 0;
            Object.values(history).forEach(dateStr => {
                const date = new Date(dateStr);
                if (date >= oneWeekAgo) weeklyCompletions++;
            });

            return { today: completedToday, thisWeek: weeklyCompletions };
        }

        function getCompletionStreak() {
            const history = JSON.parse(localStorage.getItem('moves-completion-history')) || {};
            const dateCompletions = {};

            // Count completions per date
            Object.values(history).forEach(dateStr => {
                dateCompletions[dateStr] = (dateCompletions[dateStr] || 0) + 1;
            });

            // Calculate streak
            const today = new Date();
            let streak = 0;
            let checkDate = new Date(today);

            // Check if today has completions, if not start from yesterday
            const todayStr = today.toISOString().split('T')[0];
            if (!dateCompletions[todayStr]) {
                checkDate.setDate(checkDate.getDate() - 1);
            }

            while (true) {
                const dateStr = checkDate.toISOString().split('T')[0];
                if (dateCompletions[dateStr] && dateCompletions[dateStr] > 0) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }

            return streak;
        }

        function getTotalProgress() {
            let totalSteps = 0;
            let doneSteps = 0;

            data.businesses.forEach(b => {
                b.goals.forEach(g => {
                    totalSteps += g.steps.length;
                    doneSteps += g.steps.filter(s => s.done).length;
                });
            });

            return { total: totalSteps, done: doneSteps, percent: totalSteps > 0 ? Math.round((doneSteps / totalSteps) * 100) : 0 };
        }

        function renderSummary() {
            const summaryEl = document.getElementById('summary-content');
            if (!summaryEl) return;

            const parts = [];

            // Upcoming deadline
            const deadline = getUpcomingDeadline();
            if (deadline) {
                const dayText = deadline.days === 0 ? 'today' : deadline.days === 1 ? 'tomorrow' : `in ${deadline.days} days`;
                parts.push(`<span class="deadline">${deadline.title}</span> ${dayText}`);
            }

            // Recent wins
            const wins = getRecentWins();
            if (wins.thisWeek > 0) {
                parts.push(`Completed <span class="highlight">${wins.thisWeek} steps</span> this week ${wins.thisWeek >= 5 ? 'ðŸ”¥' : ''}`);
            }

            // Streak
            const streak = getCompletionStreak();
            if (streak > 1) {
                parts.push(`<span class="streak">${streak}-day streak!</span> Keep it up ðŸ’ª`);
            }

            // Overall progress if nothing else to show
            if (parts.length === 0) {
                const progress = getTotalProgress();
                if (progress.total > 0) {
                    parts.push(`${progress.percent}% complete â€” <span class="milestone">time to make some moves!</span>`);
                } else {
                    parts.push('Ready to crush your goals? Add some steps and get started! ðŸš€');
                }
            }

            // Show 1-2 sentences max
            summaryEl.innerHTML = parts.slice(0, 2).join(' â€¢ ');
        }
        
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelector(`.tab:nth-child(${tab === 'tasks' ? 1 : 2})`).classList.add('active');
            document.getElementById(`${tab}-view`).classList.add('active');
            if (tab === 'calendar') renderCalendar();
        }
        
        function setCalView(view) {
            calView = view;
            document.querySelectorAll('.view-toggle button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderCalendar();
        }
        
        function navCalendar(dir) {
            if (calView === 'daily') calDate.setDate(calDate.getDate() + dir);
            else if (calView === 'weekly') calDate.setDate(calDate.getDate() + (dir * 7));
            else if (calView === 'monthly') calDate.setMonth(calDate.getMonth() + dir);
            else if (calView === 'annual') calDate.setFullYear(calDate.getFullYear() + dir);
            renderCalendar();
        }
        
        function renderCalendar() {
            const content = document.getElementById('calendar-content');
            const title = document.getElementById('calendar-title');
            const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
            const today = new Date();
            
            if (calView === 'monthly') {
                title.textContent = `${months[calDate.getMonth()]} ${calDate.getFullYear()}`;
                const firstDay = new Date(calDate.getFullYear(), calDate.getMonth(), 1);
                const lastDay = new Date(calDate.getFullYear(), calDate.getMonth() + 1, 0);
                const startDay = firstDay.getDay();
                
                let html = '<div class="calendar-grid"><div class="weekdays">';
                days.forEach(d => html += `<div class="weekday">${d}</div>`);
                html += '</div><div class="days">';
                
                const prevMonth = new Date(calDate.getFullYear(), calDate.getMonth(), 0);
                for (let i = startDay - 1; i >= 0; i--) {
                    html += `<div class="day other-month"><span class="day-num">${prevMonth.getDate() - i}</span></div>`;
                }
                
                for (let d = 1; d <= lastDay.getDate(); d++) {
                    const dateStr = `${calDate.getFullYear()}-${String(calDate.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                    const dayEvents = data.events.filter(e => e.date === dateStr);
                    const isToday = today.getDate() === d && today.getMonth() === calDate.getMonth() && today.getFullYear() === calDate.getFullYear();
                    html += `<div class="day${isToday ? ' today' : ''}" onclick="selectDay('${dateStr}')">
                        <span class="day-num">${d}</span>
                        <div class="day-events">${dayEvents.slice(0,3).map(() => '<div class="event-dot"></div>').join('')}</div>
                    </div>`;
                }
                
                const remaining = 42 - (startDay + lastDay.getDate());
                for (let d = 1; d <= remaining; d++) {
                    html += `<div class="day other-month"><span class="day-num">${d}</span></div>`;
                }
                
                html += '</div></div>';
                content.innerHTML = html;
                
            } else if (calView === 'daily') {
                title.textContent = calDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
                const dateStr = calDate.toISOString().split('T')[0];
                const dayEvents = data.events.filter(e => e.date === dateStr);
                const isToday = today.toDateString() === calDate.toDateString();
                
                let html = `<div class="schedule"><div class="schedule-day">
                    <div class="schedule-day-header${isToday ? ' today' : ''}">${isToday ? 'Today' : calDate.toLocaleDateString('en-US', { weekday: 'long' })}</div>`;
                
                if (dayEvents.length === 0) {
                    html += '<div class="no-events">No events scheduled</div>';
                } else {
                    dayEvents.forEach(e => {
                        html += `<div class="event">
                            <div><div class="event-title">${e.title}</div>${e.time ? `<div class="event-time">${e.time}</div>` : ''}</div>
                            <button class="btn small danger" onclick="deleteEvent(${e.id})">Ã—</button>
                        </div>`;
                    });
                }
                html += '</div></div>';
                content.innerHTML = html;
                
            } else if (calView === 'weekly') {
                const startOfWeek = new Date(calDate);
                startOfWeek.setDate(calDate.getDate() - calDate.getDay());
                const endOfWeek = new Date(startOfWeek);
                endOfWeek.setDate(startOfWeek.getDate() + 6);
                
                title.textContent = `${startOfWeek.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${endOfWeek.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;
                
                let html = '<div class="schedule">';
                for (let i = 0; i < 7; i++) {
                    const d = new Date(startOfWeek);
                    d.setDate(startOfWeek.getDate() + i);
                    const dateStr = d.toISOString().split('T')[0];
                    const dayEvents = data.events.filter(e => e.date === dateStr);
                    const isToday = today.toDateString() === d.toDateString();
                    
                    html += `<div class="schedule-day">
                        <div class="schedule-day-header${isToday ? ' today' : ''}">${d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}${isToday ? ' (Today)' : ''}</div>`;
                    
                    if (dayEvents.length === 0) {
                        html += '<div class="no-events">No events</div>';
                    } else {
                        dayEvents.forEach(e => {
                            html += `<div class="event">
                                <div><div class="event-title">${e.title}</div>${e.time ? `<div class="event-time">${e.time}</div>` : ''}</div>
                                <button class="btn small danger" onclick="deleteEvent(${e.id})">Ã—</button>
                            </div>`;
                        });
                    }
                    html += '</div>';
                }
                html += '</div>';
                content.innerHTML = html;
                
            } else if (calView === 'annual') {
                title.textContent = calDate.getFullYear();
                let html = '<div class="annual-grid">';
                
                for (let m = 0; m < 12; m++) {
                    const firstDay = new Date(calDate.getFullYear(), m, 1);
                    const lastDay = new Date(calDate.getFullYear(), m + 1, 0);
                    const startDay = firstDay.getDay();
                    
                    html += `<div class="mini-month"><div class="mini-month-title">${months[m]}</div><div class="mini-days">`;
                    
                    for (let i = 0; i < startDay; i++) html += '<div class="mini-day"></div>';
                    
                    for (let d = 1; d <= lastDay.getDate(); d++) {
                        const dateStr = `${calDate.getFullYear()}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                        const hasEvent = data.events.some(e => e.date === dateStr);
                        const isToday = today.getDate() === d && today.getMonth() === m && today.getFullYear() === calDate.getFullYear();
                        html += `<div class="mini-day${hasEvent ? ' has-event' : ''}${isToday ? ' today' : ''}">${d}</div>`;
                    }
                    
                    html += '</div></div>';
                }
                html += '</div>';
                content.innerHTML = html;
            }
        }
        
        function selectDay(dateStr) {
            selectedDate = new Date(dateStr + 'T12:00:00');
            calDate = new Date(dateStr + 'T12:00:00');
            calView = 'daily';
            document.querySelectorAll('.view-toggle button').forEach(b => b.classList.remove('active'));
            document.querySelector('.view-toggle button:first-child').classList.add('active');
            renderCalendar();
        }
        
        function deleteEvent(id) {
            if (confirm('Delete this event?')) {
                data.events = data.events.filter(e => e.id !== id);
                save();
                renderCalendar();
            }
        }
        
        function openAdd() {
            if (currentTab === 'tasks') {
                openAddBusiness();
            } else {
                openAddEvent();
            }
        }
        
        function openAddEvent() {
            const dateStr = calDate.toISOString().split('T')[0];
            document.getElementById('modal-inner').innerHTML = `
                <h2>Add Event</h2>
                <label>Title</label>
                <input type="text" id="event-title" placeholder="Event title...">
                <label>Date</label>
                <input type="date" id="event-date" value="${dateStr}">
                <label>Time (optional)</label>
                <input type="time" id="event-time">
                <div class="actions">
                    <button class="btn ghost" onclick="closeModal()">Cancel</button>
                    <button class="btn" onclick="saveEvent()">Save</button>
                </div>
            `;
            document.getElementById('modal').classList.add('open');
            document.getElementById('event-title').focus();
        }
        
        function saveEvent() {
            const title = document.getElementById('event-title').value.trim();
            const date = document.getElementById('event-date').value;
            const time = document.getElementById('event-time').value;
            if (!title || !date) return;
            
            const newId = data.events.length > 0 ? Math.max(...data.events.map(e => e.id)) + 1 : 1;
            data.events.push({ id: newId, title, date, time });
            save();
            closeModal();
            renderCalendar();
        }
        
        // Task functions
        function render() {
            const app = document.getElementById('app');
            if (!app) return;
            app.innerHTML = data.businesses.map(b => {
                const totalSteps = b.goals.reduce((sum, g) => sum + g.steps.length, 0);
                const doneSteps = b.goals.reduce((sum, g) => sum + g.steps.filter(s => s.done).length, 0);
                const progress = totalSteps > 0 ? Math.round((doneSteps / totalSteps) * 100) : 0;
                
                return `
                    <div class="business" id="biz-${b.id}">
                        <div class="business-header" onclick="toggleBusiness(${b.id})">
                            <h2>${b.name}</h2>
                            <span class="progress">${progress}%</span>
                        </div>
                        <div class="business-content">
                            ${b.goals.map(g => {
                                const gDone = g.steps.filter(s => s.done).length;
                                const gTotal = g.steps.length;
                                return `
                                    <div class="goal">
                                        <div class="goal-header">
                                            <h3>${g.name} ${gTotal > 0 ? `(${gDone}/${gTotal})` : ''}</h3>
                                            <div class="edit-delete">
                                                <button class="btn small ghost" onclick="editGoal(${b.id}, ${g.id})">âœŽ</button>
                                                <button class="btn small danger" onclick="deleteGoal(${b.id}, ${g.id})">Ã—</button>
                                            </div>
                                        </div>
                                        ${g.steps.map(s => `
                                            <div class="step ${s.done ? 'done' : ''}">
                                                <input type="checkbox" ${s.done ? 'checked' : ''} onchange="toggleStep(${b.id}, ${g.id}, ${s.id})">
                                                <span ondblclick="editStep(${b.id}, ${g.id}, ${s.id})">${s.text}</span>
                                            </div>
                                        `).join('')}
                                        <div class="add-form">
                                            <input type="text" placeholder="Add step..." id="step-input-${b.id}-${g.id}" onkeypress="if(event.key==='Enter')addStep(${b.id}, ${g.id})">
                                            <button class="btn small" onclick="addStep(${b.id}, ${g.id})">+</button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                            <button class="btn" onclick="openAddGoal(${b.id})">+ Add Goal</button>
                            <button class="btn ghost" onclick="editBusiness(${b.id})">Edit</button>
                            <button class="btn danger" onclick="deleteBusiness(${b.id})">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
            renderSummary();
        }

        function toggleBusiness(id) { document.getElementById(`biz-${id}`).classList.toggle('open'); }
        
        function toggleStep(bizId, goalId, stepId) {
            const biz = data.businesses.find(b => b.id === bizId);
            const goal = biz.goals.find(g => g.id === goalId);
            const step = goal.steps.find(s => s.id === stepId);
            step.done = !step.done;
            save(); render();
        }
        
        function addStep(bizId, goalId) {
            const input = document.getElementById(`step-input-${bizId}-${goalId}`);
            if (!input.value.trim()) return;
            const biz = data.businesses.find(b => b.id === bizId);
            const goal = biz.goals.find(g => g.id === goalId);
            const newId = goal.steps.length > 0 ? Math.max(...goal.steps.map(s => s.id)) + 1 : 1;
            goal.steps.push({ id: newId, text: input.value.trim(), done: false });
            input.value = '';
            save(); render();
        }
        
        function openAddBusiness() {
            document.getElementById('modal-inner').innerHTML = `
                <h2>Add Business</h2>
                <input type="text" id="modal-input" placeholder="Enter name...">
                <div class="actions">
                    <button class="btn ghost" onclick="closeModal()">Cancel</button>
                    <button class="btn" onclick="saveBusiness()">Save</button>
                </div>
            `;
            document.getElementById('modal').classList.add('open');
            document.getElementById('modal-input').focus();
        }
        
        function saveBusiness() {
            const value = document.getElementById('modal-input').value.trim();
            if (!value) return;
            const newId = data.businesses.length > 0 ? Math.max(...data.businesses.map(b => b.id)) + 1 : 1;
            data.businesses.push({ id: newId, name: value, goals: [] });
            save(); render(); closeModal();
        }
        
        function openAddGoal(bizId) {
            document.getElementById('modal-inner').innerHTML = `
                <h2>Add Goal</h2>
                <input type="text" id="modal-input" placeholder="Enter goal...">
                <div class="actions">
                    <button class="btn ghost" onclick="closeModal()">Cancel</button>
                    <button class="btn" onclick="saveGoal(${bizId})">Save</button>
                </div>
            `;
            document.getElementById('modal').classList.add('open');
            document.getElementById('modal-input').focus();
        }
        
        function saveGoal(bizId) {
            const value = document.getElementById('modal-input').value.trim();
            if (!value) return;
            const biz = data.businesses.find(b => b.id === bizId);
            const newId = biz.goals.length > 0 ? Math.max(...biz.goals.map(g => g.id)) + 1 : 1;
            biz.goals.push({ id: newId, name: value, steps: [] });
            save(); render(); closeModal();
        }
        
        function editBusiness(id) {
            const biz = data.businesses.find(b => b.id === id);
            document.getElementById('modal-inner').innerHTML = `
                <h2>Edit Business</h2>
                <input type="text" id="modal-input" value="${biz.name}">
                <div class="actions">
                    <button class="btn ghost" onclick="closeModal()">Cancel</button>
                    <button class="btn" onclick="updateBusiness(${id})">Save</button>
                </div>
            `;
            document.getElementById('modal').classList.add('open');
            document.getElementById('modal-input').focus();
        }
        
        function updateBusiness(id) {
            const value = document.getElementById('modal-input').value.trim();
            if (!value) return;
            const biz = data.businesses.find(b => b.id === id);
            biz.name = value;
            save(); render(); closeModal();
        }
        
        function editGoal(bizId, goalId) {
            const biz = data.businesses.find(b => b.id === bizId);
            const goal = biz.goals.find(g => g.id === goalId);
            document.getElementById('modal-inner').innerHTML = `
                <h2>Edit Goal</h2>
                <input type="text" id="modal-input" value="${goal.name}">
                <div class="actions">
                    <button class="btn ghost" onclick="closeModal()">Cancel</button>
                    <button class="btn" onclick="updateGoal(${bizId}, ${goalId})">Save</button>
                </div>
            `;
            document.getElementById('modal').classList.add('open');
            document.getElementById('modal-input').focus();
        }
        
        function updateGoal(bizId, goalId) {
            const value = document.getElementById('modal-input').value.trim();
            if (!value) return;
            const biz = data.businesses.find(b => b.id === bizId);
            const goal = biz.goals.find(g => g.id === goalId);
            goal.name = value;
            save(); render(); closeModal();
        }
        
        function editStep(bizId, goalId, stepId) {
            const biz = data.businesses.find(b => b.id === bizId);
            const goal = biz.goals.find(g => g.id === goalId);
            const step = goal.steps.find(s => s.id === stepId);
            const newText = prompt('Edit step:', step.text);
            if (newText && newText.trim()) {
                step.text = newText.trim();
                save(); render();
            }
        }
        
        function deleteBusiness(id) {
            if (confirm('Delete this business and all its goals?')) {
                data.businesses = data.businesses.filter(b => b.id !== id);
                save(); render();
            }
        }
        
        function deleteGoal(bizId, goalId) {
            if (confirm('Delete this goal and all its steps?')) {
                const biz = data.businesses.find(b => b.id === bizId);
                biz.goals = biz.goals.filter(g => g.id !== goalId);
                save(); render();
            }
        }
        
        function closeModal() { document.getElementById('modal').classList.remove('open'); }
        
        document.getElementById('modal').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const saveBtn = document.querySelector('.modal .btn:not(.ghost)');
                if (saveBtn) saveBtn.click();
            }
        });

        // Daily Affirmation System
        const affirmations = [
            "I am a money magnet. Wealth flows to me effortlessly.",
            "I think like a CEO. I move like a boss.",
            "My ideas are worth millions. My execution is priceless.",
            "I don't chase. I attract.",
            "Winners don't wait. Winners execute.",
            "I am building an empire, one move at a time.",
            "Abundance is my birthright. Success is my reality.",
            "I invest in myself because I am my greatest asset.",
            "Every decision I make multiplies my wealth.",
            "I am the architect of my own fortune.",
            "Money works for me while I sleep. That's boss thinking.",
            "I turn obstacles into opportunities. That's the millionaire mindset.",
            "My network is my net worth. I build with kings.",
            "I don't compete. I dominate.",
            "Scarcity is a mindset. I operate in abundance.",
            "I am the standard. Others rise to meet it.",
            "My vision is clear. My moves are calculated. My success is inevitable.",
            "I create value and wealth follows.",
            "Fear is temporary. Regret is forever. I choose action.",
            "I am not lucky. I am prepared, focused, and relentless.",
            "My time is valuable. I invest it wisely.",
            "I don't ask for permission to be great. I just am.",
            "Every day is a new opportunity to level up.",
            "I think big, act bold, and win always.",
            "My potential is unlimited. My grind is unmatched.",
            "I build generational wealth starting today.",
            "I am the main character in my success story.",
            "Comfort zones are for the average. I am exceptional.",
            "I see what others don't. I do what others won't.",
            "My mindset is worth more than any bank account. But both are growing.",
            "I am not playing the game. I am changing it.",
            "Success is not an option. It's the only destination.",
            "I am patient with results but relentless with my effort.",
            "Ordinary people wish. Bosses work. I am a boss.",
            "My legacy is being written with every move I make."
        ];

        function getDailyAffirmation() {
            const today = new Date();
            // Create a unique number based on year, month, and day
            const dateNumber = today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
            // Use the date to consistently select an affirmation
            const index = dateNumber % affirmations.length;
            return affirmations[index];
        }

        // Set the daily affirmation on page load
        document.getElementById('daily-affirmation').textContent = getDailyAffirmation();

        render();
        renderSummary();
    </script>
</body>
</html>
